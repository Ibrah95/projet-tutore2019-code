!function(e){function t(a){if(o[a])return o[a].exports;var r=o[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,a){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(t.WINDOW_WIDTH=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t.WINDOW_HEIGHT=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t.WORLD_SIZE={width:2024,height:1e3});t.ASSETS_URL="../assets",t.NBR_POPBOX_COLONNE=2,t.POS_Y_POPBOX=a.height/2+200,t.NBR_POPBOX_LIGNE="3"===localStorage.getItem("stage")?4:3,t.NBR_MONSTRE_LIGNE="3"===localStorage.getItem("stage")?1:2,t.NBR_MONSTRE_COLONNE="3"===localStorage.getItem("stage")?3:2,t.DIST_LIGNE="3"===localStorage.getItem("stage")?600:800,t.DIST_COLONNE=600,t.LIMIT_TOP=200,t.LIMIT_BOTTOM=2e3,t.LIMIT_LEFT=100,t.LIMIT_RIGHT=2e3,t.TEMP_INIT="3"===localStorage.getItem("stage")?70:30},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.isDown=function(e,t){return e.input.keyboard.isDown(t)},t.createText=function(e,t){return e.add.text(t.x,t.y,"",{fontSize:"12px",fill:"#FFF",align:"center"})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,n,i,s){return{socket:s,type:e,sprite:(0,r.default)(e,t,a,n,i),playerName:null,speed:0,speedText:null,estCapturer:!1,nombreCapture:o,customName:t,drive:function(e){},emitPlayerData:function(){this.socket.emit("move-player",{estCapturer:this.estCapturer,nombreCapture:this.nombreCapture,type:this.type,x:this.sprite.body.x,y:this.sprite.body.y,angle:this.sprite.body.rotation,playerName:{name:this.playerName.text,x:this.playerName.x,y:this.playerName.y},speed:{value:this.speed,x:this.speedText.x,y:this.speedText.y}})},emitPlayerDeletion:function(e){e.emit("delete-player",{id:this.playerName.text})},emitNombreCapture:function(e){e.emit("increment-nombreCapture",{id:this.playerName.text})},updatePlayerName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.socket.id,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sprite.body.x-57,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sprite.body.y-59;this.playerName.text=String(e),this.playerName.x=t,this.playerName.y=o,i.world.bringToTop(this.playerName)},updatePlayerStatusText:function(e,t,o){"popbox"===this.type&&(o.x=e-57,o.y=t-39,o.text="NOMBRE DE CAPTURE = "+this.nombreCapture,i.world.bringToTop(o))}}};var a=o(7),r=function(e){return e&&e.__esModule?e:{default:e}}(a);o(1)},function(e,t,o){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=o(0),s=o(4),p=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){a(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.WINDOW_WIDTH,i.WINDOW_HEIGHT,Phaser.AUTO));return e.state.add("Game",p.default),e.state.start("Game"),e}return n(t,e),t}(Phaser.Game);new l},function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(){Q=!0,K.play()}function p(){if(!D&&Q)if(L>0)if(!1===X)L--;else{l(localStorage.getItem("vague_courant"));var e=Object.keys(x).length;U[k-1]<=e&&(X=!1,u(!0)),2===L&&R.emit("temps-ecouler",!0)}else{var t=Number.parseInt(localStorage.getItem("stage"));x={},D=!0,k+=1,R.emit("temps-ecouler",!0),t<=3?k<=F?(u(!1),j||(localStorage.setItem("vague_courant",k),j=!0,u(!1),R.emit("temps-ecouler",!0),window.location.assign("/chargement_vague?vague="+k))):W||(u(!1),t<3?(k=1,localStorage.setItem("vague_courant",k),t+=1,localStorage.setItem("stage",t),W=!0,R.emit("temps-ecouler",!0),window.location.assign("/chargement_vague?vague="+k)):window.location.assign("/winner")):window.location.assign("/winner")}M=Number.parseInt(L/60),C=Number.parseInt(L%60)}function l(e){var t=new XMLHttpRequest;t.onreadystatechange=function(e){this.readyState===XMLHttpRequest.DONE&&this.status},t.open("PUT","/update_vague_courant?vague="+e,!0),t.send(null)}function u(e){console.log("entrer dans updateJeuEnCours");var t=new XMLHttpRequest;t.onreadystatechange=function(e){this.readyState===XMLHttpRequest.DONE&&this.status},t.open("PUT","/update_jeu_en_cours?valeur="+e,!0),t.send(null)}function c(){G||(H>0?H--:(H=2,G=!0))}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,o,a){return o&&e(t.prototype,o),a&&e(t,a),t}}(),_=o(0),y=(o(1),o(5)),h=a(y),g=o(6),m=a(g),f=o(2),O=(a(f),o(8)),S=a(O),T=o(9),N=a(T),b=o(10),I=o(11),v=a(I),E=o(12),P=a(E),R=null,x={},L=_.TEMP_INIT,M=Number.parseInt(L/60),C=Number.parseInt(L%60),w=null,A=null,B=null,D=!1,F=Number.parseInt(localStorage.getItem("nbr_vague")),k=(Number.parseInt(localStorage.getItem("duree_vague")),Number.parseInt(localStorage.getItem("vague_courant"))),W=!1,j=!1,U=[],X=!0,G=!1,H=2,Z=new Array(_.NBR_POPBOX_LIGNE*_.NBR_POPBOX_COLONNE).fill(0),q=new Array(_.NBR_POPBOX_LIGNE*_.NBR_POPBOX_COLONNE).fill(0),Y=new Array(_.NBR_MONSTRE_LIGNE*_.NBR_MONSTRE_COLONNE).fill(0),J=new Array(_.NBR_MONSTRE_LIGNE*_.NBR_MONSTRE_COLONNE).fill(0),V=[],z=[],K=null,Q=!1,$=function(e){function t(){r(this,t);var e=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.player={},e}return i(t,e),d(t,[{key:"preload",value:function(){(0,h.default)(this.game)}},{key:"create",value:function(){var e=_.WORLD_SIZE.width,t=_.WORLD_SIZE.height;(0,m.default)(this.game),R=io("localhost:8080/"),(0,v.default)(R,x,this.game),"2"!==localStorage.getItem("stage")&&(V=(0,S.default)(this.game)),"1"!==localStorage.getItem("stage")&&(z=(0,N.default)(this.game));var o=this.game.time.create(!1);o.loop(1e3,p,this.game),o.start();for(var a=0;a<F;a++)U[a]=Number.parseInt(localStorage.getItem("nbr_joueur_vague_"+(a+1)));var r=this.game.time.create(!1);r.loop(1e3,c,this.game),r.start(),this.game.camera.x=e/2,this.game.camera.y=t/2,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,w=this.game.add.text(_.WORLD_SIZE.width/2+320,50,"0"+M+" : "+(C<10?"0":"")+C,{font:"100px Courier Black",fill:"#FF8C00"}),w.stroke="#FFFFFF",w.strokeThickness=20,w.setShadow(2,2,"#333333",2,!0,!0),K=this.game.add.audio("music"),this.game.sound.setDecodedCallback(K,s,this),this.game.sound.play("music",1,!0),A=this.game.add.text(_.WORLD_SIZE.width/2+400,_.WORLD_SIZE.height/2,"G O",{font:"400px Courier Black",fill:"#FF8C00"}),A.stroke="#FFFFFF",A.strokeThickness=50,A.setShadow(2,2,"#FFFFFF",2,!0,!0),A.alpha=0,B=this.game.add.text(_.WORLD_SIZE.width/2+400,_.WORLD_SIZE.height/2,"FIN",{font:"400px Courier Black",fill:"#FF8C00"}),B.stroke="#FFFFFF",B.strokeThickness=50,B.setShadow(2,2,"#FFFFFF",2,!0,!0),B.alpha=0}},{key:"update",value:function(){if(Q&&!X&&!D){(0,P.default)(x,V,z,this.game,R);var e=(0,b.movementIA)(V,this.game,G,q,Z);if(Z=e.vitesseAlea,q=e.directionAlea,"1"!==localStorage.getItem("stage")){var t="2"===localStorage.getItem("stage")?-1:1,o=(0,b.movementIAMonstre)(z,this.game,G,J,Y,t);Y=o.vitesseAlea,J=o.directionAlea}G=!1}R.on("notification-temps-ecouler",function(e){window.alert("TEMPS ECOULER !!!\n\n NOMBRE POPCORN ARRIVÉ : "+e.nombre_de_popcorn_arriver+" \n NOMBRE DE POPCORN CAPTURÉ : "+e.nombre_de_popcorn_capturer)}),R.on("update-time",function(e){var t=e.pseudo,o=new XMLHttpRequest,a=_.TEMP_INIT-L;o.onreadystatechange=function(e){this.readyState===XMLHttpRequest.DONE&&this.status},o.open("PUT","/update_time?pseudo="+t+"&time="+a,!0),o.send(null)})}},{key:"render",value:function(){w.setText("0"+M+" : "+(C<10?"0":"")+C),Q&&!X&&(L>_.TEMP_INIT-2&&(A.alpha=1),L<=_.TEMP_INIT-2&&0!=A.alpha&&(A.alpha-=.1),L<=3&&(B.alpha+=.1))}}]),t}(Phaser.State);t.default=$},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),r=function(e){e.load.crossOrigin="Anonymous",e.stage.backgroundColor="#1E1E1E","2"===localStorage.getItem("stage")?e.load.image("asphalt",a.ASSETS_URL+"/sprites/asphalt/ground_"+localStorage.getItem("stage")+".png"):e.load.image("asphalt",a.ASSETS_URL+"/sprites/asphalt/ground_"+localStorage.getItem("stage")+".jpg"),e.load.spritesheet("pop_marley",a.ASSETS_URL+"/sprites/popcorn/pop_marley.png",300,300,4),e.load.spritesheet("bat_pop",a.ASSETS_URL+"/sprites/popcorn/bat_pop.png",300,300,4),e.load.spritesheet("pop_soldat",a.ASSETS_URL+"/sprites/popcorn/pop_soldat.png",300,300,4),e.load.spritesheet("caramba_pop",a.ASSETS_URL+"/sprites/popcorn/caramba_pop.png",300,300,4),e.load.spritesheet("pop_vador",a.ASSETS_URL+"/sprites/popcorn/pop_vador.png",300,300,4),e.load.spritesheet("gentle_pop",a.ASSETS_URL+"/sprites/popcorn/gentle_pop.png",300,300,4),e.load.spritesheet("pop_blood_gang",a.ASSETS_URL+"/sprites/popcorn/pop_blood_gang.png",300,300,4),e.load.spritesheet("pop_boy",a.ASSETS_URL+"/sprites/popcorn/pop_boy.png",300,300,4),e.load.spritesheet("pop_kent",a.ASSETS_URL+"/sprites/popcorn/pop_kent.png",300,300,4),e.load.spritesheet("pop_carrey",a.ASSETS_URL+"/sprites/popcorn/pop_carrey.png",300,300,4),e.load.spritesheet("pop_minator",a.ASSETS_URL+"/sprites/popcorn/pop_minator.png",300,300,4),e.load.spritesheet("pop_ninja",a.ASSETS_URL+"/sprites/popcorn/pop_ninja.png",300,300,4),e.load.spritesheet("saint_patrick_pop",a.ASSETS_URL+"/sprites/popcorn/saint_patrick_pop.png",300,300,4),e.load.spritesheet("santa_pop",a.ASSETS_URL+"/sprites/popcorn/santa_pop.png",300,300,4),e.load.spritesheet("thug_pop",a.ASSETS_URL+"/sprites/popcorn/thug_pop.png",300,300,4),e.load.image("popbox",a.ASSETS_URL+"/sprites/popbox/popbox"+localStorage.getItem("stage")+".png"),e.load.spritesheet("bird",a.ASSETS_URL+"/sprites/enemies/birds_1.png",183,168,14),e.load.image("car",a.ASSETS_URL+"/sprites/enemies/car_2.png"),e.load.audio("music",[a.ASSETS_URL+"/audio/music_"+localStorage.getItem("stage")+".mp3",a.ASSETS_URL+"/audio/music_"+localStorage.getItem("stage")+".ogg"])};t.default=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),r=a.WORLD_SIZE.width,n=a.WORLD_SIZE.height,i=function(e){e.physics.startSystem(Phaser.Physics.P2JS),e.stage.disableVisibilityChange=!0,e.world.setBounds(0,0,r,n),s(e)},s=function(e){for(var t=[],o=0;o<=r/64;o++)for(var a=0;a<=n/64;a++){var i=e.add.sprite(400*o,400*a,"asphalt");i.width=400,i.height=400,t.push(i)}};t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,o,a,r){var n=null;return n="popcorn"===e?r.add.sprite(o,a,t):r.add.sprite(o,a,e),r.physics.enable(n,Phaser.Physics.ARCADE),r.physics.startSystem(Phaser.Physics.ARCADE),n.body.collideWorldBounds=!0,n.body.bounce.setTo(1,1),n.anchor.setTo(.5,.5),n.width=150,n.height=150,n.body.allowRotation=!1,n.animations.add("run"),n.animations.play("run",2,!0),n};t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),r=function(e,t,o){var a=a=o.add.sprite(e,t,"popbox");return o.physics.enable(a,Phaser.Physics.ARCADE),o.physics.startSystem(Phaser.Physics.ARCADE),a.body.collideWorldBounds=!1,a.body.checkCollision.up=!0,a.body.checkCollision.down=!0,a.body.checkCollision.right=!0,a.body.checkCollision.left=!0,a.body.bounce.setTo(1,1),a.anchor.setTo(.5,.5),a.width=200,a.height=200,a.body.allowRotation=!1,a},n=function(e){for(var t=[],o=0;o<a.NBR_POPBOX_LIGNE;o++)for(var n=0;n<a.NBR_POPBOX_COLONNE;n++){var i=a.DIST_LIGNE+a.DIST_LIGNE*o,s=a.POS_Y_POPBOX+a.DIST_COLONNE*n,p=r(i,s,e);t.push(p)}return t};t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),r=function(e,t,o){var a=void 0;return"3"===localStorage.getItem("stage")?(a=o.add.sprite(e,t,"bird"),o.physics.enable(a,Phaser.Physics.ARCADE),o.physics.startSystem(Phaser.Physics.ARCADE),a.body.collideWorldBounds=!1,a.body.checkCollision.up=!0,a.body.checkCollision.down=!0,a.body.checkCollision.left=!0,a.body.checkCollision.right=!0,a.body.bounce.setTo(1,1),a.anchor.setTo(.5,.5),a.animations.add("run"),a.animations.play("run",14,!0)):(a=o.add.sprite(e,t,"car"),o.physics.enable(a,Phaser.Physics.ARCADE),o.physics.startSystem(Phaser.Physics.ARCADE),a.body.collideWorldBounds=!1,a.body.checkCollision.up=!0,a.body.checkCollision.down=!0,a.body.checkCollision.right=!0,a.body.checkCollision.left=!0,a.body.bounce.setTo(1,1),a.anchor.setTo(.5,.5),a.width=400,a.height=300),a},n=function(e){for(var t=[],o=0;o<a.NBR_MONSTRE_LIGNE;o++)for(var n=0;n<a.NBR_MONSTRE_COLONNE;n++){var i=a.DIST_LIGNE+a.DIST_LIGNE*o,s=a.POS_Y_POPBOX+a.DIST_COLONNE*n,p=r(i,s,e);t.push(p)}return t};t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.movementIAMonstre=t.movementIA=void 0;var a=o(0),r=function(e,t,o,r,n){1==o&&(r=i(e),n=s(e));for(var p=0;p<e.length;p++)p%2==0?(e[p].position.y<=a.LIMIT_TOP&&(r[p]=1),e[p].position.y>=a.LIMIT_BOTTOM/2-40&&(r[p]=-1)):(e[p].position.y<=a.LIMIT_BOTTOM/2-40&&(r[p]=1),e[p].position.y>=a.LIMIT_BOTTOM&&(r[p]=-1)),e[p].position.y+=r[p]*n[p];return{directionAlea:r,vitesseAlea:n}},n=function(e,t,o,r,n){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;1==o&&(r=i(e),n=s(e));for(var c=0;c<e.length;c++)c%2==0?(e[c].position.y<=a.LIMIT_TOP&&(r[c]=1),e[c].position.y>=a.LIMIT_BOTTOM/2-40&&(r[c]=-1)):(e[c].position.y<=a.LIMIT_BOTTOM/2-40&&(r[c]=1),e[c].position.y>=a.LIMIT_BOTTOM&&(r[c]=-1)),u>0?p(e[c],n[c]):l(e[c],n[c]),e[c].position.y+=r[c]*n[c];return{directionAlea:r,vitesseAlea:n}},i=function(e){for(var t=[],o=void 0,a=0;a<e.length;a++)o=Math.floor(12*Math.random()),t[a]=o%2==0?-1:1;return t},s=function(e){for(var t=[],o=void 0,a=0;a<e.length;a++)o=5*Math.random()+5,t[a]=o;return t},p=function(e,t){var o=Math.floor(Math.random()*a.NBR_POPBOX_COLONNE);e.position.x>=a.WINDOW_WIDTH&&(e.position.x=-200,e.position.y=a.POS_Y_POPBOX+a.DIST_COLONNE*o),e.position.x+=1*t},l=function(e,t){var o=Math.floor(Math.random()*a.NBR_POPBOX_COLONNE);e.position.x<0&&(e.position.x=a.WINDOW_WIDTH+200,e.position.y=a.POS_Y_POPBOX+a.DIST_COLONNE*o),e.position.x+=-1*t};t.movementIA=r,t.movementIAMonstre=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(2),r=function(e){return e&&e.__esModule?e:{default:e}}(a),n=o(1),i=function(e,t,o){e.on("update-players",function(a){var i={};for(var s in a){var p=a[s];if(void 0===t[s]&&s!==e.id){var l=(0,r.default)(p.type,p.customName,p.nombreCapture,p.x,p.y,o);l.playerName=(0,n.createText)(o,l),l.speedText=(0,n.createText)(o,l),l.updatePlayerName(p.playerName.name,p.playerName.x,p.playerName.y),l.updatePlayerStatusText(p.playerName.x,p.playerName.y+60,l.speedText),t[s]=l,i[s]=!0}i[s]=!0,!0===p.estCapturer&&(i[s]=!1),s!==e.id&&!0===i[s]&&(t[s].type=p.type,t[s].updatePlayerStatusText(p.playerName.x,p.playerName.y+60,t[s].speedText),t[s].nombreCapture=p.nombreCapture,t[s].target_x=p.x,t[s].target_y=p.y,t[s].target_rotation=p.angle,t[s].playerName.target_x=p.playerName.x,t[s].playerName.target_y=p.playerName.y,t[s].speedText.target_x=p.speed.x,t[s].speedText.target_y=p.speed.y,t[s].speed=p.speed.value)}for(var u in t)i[u]||(t[u].sprite.destroy(),t[u].playerName.destroy(),t[u].speedText.destroy(),delete t[u])})};t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,o,a,r){for(var n in e)!function(n){var i=e[n];if(void 0!==i.target_x){i.sprite.body.x+=.3*(i.target_x-i.sprite.body.x),i.sprite.body.y+=.3*(i.target_y-i.sprite.body.y);var s=i.target_rotation,p=(s-i.sprite.body.rotation)/(2*Math.PI);p-=Math.round(p),p*=2*Math.PI,i.sprite.body.rotation+=.3*p,i.playerName.x+=.3*(i.playerName.target_x-i.playerName.x),i.playerName.y+=.3*(i.playerName.target_y-i.playerName.y),i.speedText.x+=.3*(i.speedText.target_x-i.speedText.x),i.speedText.y+=.3*(i.speedText.target_y-i.speedText.y),i.updatePlayerStatusText(i.playerName.x,i.playerName.y+60,i.speedText);for(var l in t)a.physics.arcade.collide(i.sprite,t[l],function(e,t){i.emitPlayerDeletion(r),i.emitNombreCapture(r)});for(var u in o)a.physics.arcade.collide(i.sprite,o[u],function(e,t){i.emitPlayerDeletion(r),i.emitNombreCapture(r)});for(var c in e)a.physics.arcade.collide(i.sprite,e[c].sprite,function(e,t){})}}(n)};t.default=a}]);